<!-- Modern B2B Professional Header -->
<header
  class="sticky top-0 z-50 w-full bg-white/95 backdrop-blur-lg supports-[backdrop-filter]:backdrop-blur-lg border-b border-slate-200/60 shadow-sm"
  role="banner"
  (document:keydown)="onMenuKeydown($event)">

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">

      <!-- Logo and Brand -->
      <p-button
        (onClick)="navigateToLanding()"
        [text]="true"
        styleClass="flex items-center gap-4 hover:opacity-80 transition-opacity duration-200 !p-0 !border-0 !bg-transparent"
        [attr.aria-label]="'Navigate to homepage'">
        <ng-template pTemplate="content">
          <div class="flex items-center gap-4">
            <div class="flex-shrink-0">
              <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-2.5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-200">
                <i class="pi pi-box text-white text-xl" aria-hidden="true"></i>
              </div>
            </div>
            <div class="flex flex-col">
              <span class="text-lg font-bold text-slate-900 leading-tight tracking-tight">
                {{ companyName().split(' ')[0] }}
              </span>
              @if (companyName().split(' ').length > 1) {
                <span class="text-xs text-slate-600 font-medium -mt-0.5 tracking-wide">
                  {{ companyName().split(' ').slice(1).join(' ') }} B2B
                </span>
              }
            </div>
          </div>
        </ng-template>
      </p-button>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-2" role="navigation" aria-label="Main navigation">
        <!-- All Navigation Items -->
        @for (item of navigationItems(); track item.route) {
          <p-button
            [routerLink]="item.route"
            [text]="!isRouteActive(item.route, item.exact)"
            [outlined]="isRouteActive(item.route, item.exact)"
            severity="secondary"
            size="small"
            styleClass="group relative transition-all duration-200 !px-3 !py-2"
            [class]="isRouteActive(item.route, item.exact)
              ? '!bg-blue-50 !text-blue-700 !border-blue-300 shadow-sm hover:!border-blue-400'
              : '!text-slate-700 hover:!text-blue-600 hover:!bg-slate-50/80 !border-transparent'"
            [attr.aria-label]="item.ariaLabel"
            [attr.aria-current]="isRouteActive(item.route, item.exact) ? 'page' : null">
            <ng-template pTemplate="content">
              <div class="flex items-center gap-2">
                @if (item.icon) {
                  <i [class]="'pi ' + item.icon + ' text-sm transition-colors'"
                     [ngClass]="isRouteActive(item.route, item.exact) ? 'text-blue-600' : 'text-slate-500 group-hover:text-blue-600'"
                     aria-hidden="true"></i>
                }
                <span class="text-sm font-medium tracking-wide">{{ item.label }}</span>
                @if (item.badge) {
                  <p-badge
                    [value]="item.badge"
                    severity="warn"
                    size="small">
                  </p-badge>
                }
              </div>
            </ng-template>
          </p-button>
        }
      </nav>

      <!-- Right Side Actions -->
      <div class="flex items-center gap-3">
        <!-- Cart Button (All authenticated users are B2B) -->
        @if (isAuthenticated()) {
          <div class="relative cart-panel" data-menu-trigger>
            <app-cart-panel
              [cartItems]="cartItems()"
              [cartSummary]="cartSummary()"
              (updateQuantity)="onUpdateCartQuantity($event.productId, $event.size, $event.quantity)"
              (removeItem)="onRemoveCartItem($event.productId, $event.size)"
              (viewCart)="navigateToCart()">
            </app-cart-panel>
          </div>
        }

<!-- Notifications (authenticated users only)
        @if (isAuthenticated()) {
          <div class="relative hidden sm:block notification-panel" data-menu-trigger>
            <p-button
              #notificationBtn
              icon="pi pi-bell"
              severity="secondary"
              [text]="true"
              [rounded]="true"
              size="small"
              styleClass="!text-slate-600 hover:!text-blue-600 hover:!bg-slate-50/80 transition-all duration-200 !p-2"
              (onClick)="notificationPanel.toggle($event)"
              [attr.aria-label]="'View notifications'">
            </p-button>
            @if (notificationCount() > 0) {
              <p-badge
                [value]="notificationCount() > 99 ? '99+' : notificationCount().toString()"
                severity="danger"
                styleClass="absolute -top-1 -right-1 !text-xs !min-w-4 !h-4 !leading-none !px-1">
              </p-badge>
            }

            <p-overlayPanel
              #notificationPanel
              styleClass="w-80 !p-0"
              [showTransitionOptions]="'200ms ease-out'"
              [hideTransitionOptions]="'150ms ease-in'">
              <div class="py-3">
                <div class="px-4 py-2 border-b border-slate-100">
                  <h3 class="text-sm font-semibold text-slate-900 flex items-center gap-2">
                    <i class="pi pi-bell text-blue-600" aria-hidden="true"></i>
                    Notifications
                  </h3>
                </div>
                <div class="max-h-64 overflow-y-auto">
                  <div class="px-4 py-3 hover:bg-slate-50/80 transition-colors duration-150 border-l-4 border-transparent hover:border-blue-500">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-900 truncate">New order received</p>
                        <p class="text-xs text-slate-600 mt-1">Order #12345 from Client ABC</p>
                        <p class="text-xs text-blue-600 mt-1 font-medium">2 minutes ago</p>
                      </div>
                    </div>
                  </div>
                  <div class="px-4 py-3 hover:bg-slate-50/80 transition-colors duration-150 border-l-4 border-transparent hover:border-orange-500">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-orange-500 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-900 truncate">Low stock alert</p>
                        <p class="text-xs text-slate-600 mt-1">Nike Air Max 270 - Size 42</p>
                        <p class="text-xs text-orange-600 mt-1 font-medium">1 hour ago</p>
                      </div>
                    </div>
                  </div>
                  <div class="px-4 py-3 hover:bg-slate-50/80 transition-colors duration-150 border-l-4 border-transparent hover:border-green-500">
                    <div class="flex items-start gap-3">
                      <div class="flex-shrink-0 w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                      <div class="flex-1 min-w-0">
                        <p class="text-sm font-medium text-slate-900 truncate">Payment confirmed</p>
                        <p class="text-xs text-slate-600 mt-1">Invoice #INV-2024-001</p>
                        <p class="text-xs text-green-600 mt-1 font-medium">3 hours ago</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="px-4 py-2 border-t border-slate-100 bg-slate-50/50">
                  <p-button
                    label="View all notifications"
                    [text]="true"
                    size="small"
                    styleClass="w-full !text-blue-600 hover:!text-blue-700 !font-medium">
                  </p-button>
                </div>
              </div>
            </p-overlayPanel>
          </div>
        }
-->
        <!-- User Actions -->
        @if (isAuthenticated()) {
          <!-- User Menu for Desktop -->
          <div class="relative hidden lg:block user-menu" data-menu-trigger>
            <p-button
              #userMenuBtn
              (onClick)="userMenuPanel.toggle($event)"
              severity="secondary"
              [text]="true"
              [attr.aria-label]="'User account menu'"
              styleClass="!p-2 !rounded-lg hover:!bg-slate-50/80 transition-all duration-200 group">
              <ng-template pTemplate="content">
                <div class="flex items-center gap-3">
                  <p-avatar
                    [label]="getUserInitials()"
                    styleClass="bg-blue-600 text-white !text-sm"
                    size="normal">
                  </p-avatar>

                  <div class="hidden xl:block text-left">
                    <p class="text-sm font-medium text-slate-900 leading-tight">
                      {{ getGreeting() }}
                    </p>
                    <p class="text-xs text-slate-600 leading-tight">
                      {{ currentUser()?.contactName }}
                    </p>
                  </div>

                  <i class="pi pi-chevron-down text-xs text-slate-500 transition-transform duration-200 group-hover:text-blue-600"></i>
                </div>
              </ng-template>
            </p-button>

            <!-- User Menu Panel -->
            <p-overlayPanel
              #userMenuPanel
              styleClass="w-64 !p-0"
              [showTransitionOptions]="'200ms ease-out'"
              [hideTransitionOptions]="'150ms ease-in'">
              <div class="py-2">
                <!-- User Info -->
                <div class="px-4 py-3 border-b border-slate-100">
                  <div class="flex items-center gap-3">
                    <p-avatar
                      [label]="getUserInitials()"
                      styleClass="bg-blue-600 text-white"
                      size="normal">
                    </p-avatar>
                    <div>
                      <p class="text-sm font-semibold text-slate-900">{{ currentUser()?.contactName }}</p>
                      <p class="text-xs text-slate-600">{{ currentUser()?.email || 'user@example.com' }}</p>
                    </div>
                  </div>
                </div>

                <!-- Menu Items -->
                @for (menuItem of userMenuItems(); track menuItem.label) {
                  @if (menuItem.separator) {
                    <p-divider styleClass="!my-2"></p-divider>
                  } @else {
                    <p-button
                      [label]="menuItem.label"
                      [icon]="menuItem.icon"
                      [text]="true"
                      size="small"
                      (onClick)="menuItem.command && menuItem.command({}); userMenuPanel.hide()"
                      [styleClass]="'w-full !justify-start !px-4 !py-2.5 ' + (menuItem.styleClass || '!text-slate-700 hover:!text-blue-600 hover:!bg-slate-50')">
                    </p-button>
                  }
                }
              </div>
            </p-overlayPanel>
          </div>
        } @else {
          <!-- Sign In Button for Guests -->
          <p-button
            (onClick)="onSignIn()"
            icon="pi pi-sign-in"
            label="Sign In"
            severity="primary"
            size="small"
            styleClass="!px-4 !py-2 shadow-sm hover:shadow-md transition-all duration-200"
            [attr.aria-label]="'Sign in to your business account'">
            <ng-template pTemplate="content">
              <div class="flex items-center gap-2">
                <span class="hidden sm:inline text-sm font-medium">Sign In</span>
              </div>
            </ng-template>
          </p-button>
        }

        <!-- Mobile Menu Toggle -->
        <p-button
          icon="pi pi-bars"
          severity="secondary"
          [text]="true"
          [rounded]="true"
          size="small"
          class="lg:hidden"
          styleClass="!text-slate-600 hover:!text-blue-600 hover:!bg-slate-50/80 transition-all duration-200 !p-2"
          data-menu-trigger
          (onClick)="onToggleMobileMenu()"
          [attr.aria-expanded]="isMobileMenuOpen()"
          [attr.aria-label]="'Toggle mobile menu'">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Mobile Navigation Menu -->
  @if (isMobileMenuOpen()) {
    <div class="lg:hidden mobile-menu border-t border-slate-200 bg-white/98 backdrop-blur-lg shadow-lg">
      <nav class="px-4 py-4 space-y-3" aria-label="Mobile navigation">

        <!-- User Info (for authenticated users) -->
        @if (isAuthenticated()) {
          <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg mb-4">
            <p-avatar
              [label]="getUserInitials()"
              styleClass="bg-blue-600 text-white"
              size="normal">
            </p-avatar>
            <div>
              <p class="text-sm font-semibold text-slate-900">{{ currentUser()?.contactName }}</p>
              <p class="text-xs text-slate-600">{{ currentUser()?.email || 'user@example.com' }}</p>
            </div>
          </div>
        }

        <!-- Main Navigation -->
        @for (item of navigationItems(); track item.route) {
          <a
            [routerLink]="item.route"
            (click)="closeMobileMenu()"
            [class]="isRouteActive(item.route, item.exact)
              ? 'bg-blue-50 text-blue-700 border-l-4 border-blue-500 shadow-sm'
              : 'text-slate-700 hover:text-blue-600 hover:bg-slate-50 border-l-4 border-transparent'"
            class="flex items-center justify-between px-4 py-3.5 text-base font-medium rounded-lg transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2"
            [attr.aria-label]="item.ariaLabel"
            [attr.aria-current]="isRouteActive(item.route, item.exact) ? 'page' : null">

            <div class="flex items-center">
              @if (item.icon) {
                <i [class]="'pi ' + item.icon + ' mr-3.5 text-lg'"
                   [ngClass]="isRouteActive(item.route, item.exact) ? 'text-blue-600' : 'text-slate-500'"
                   aria-hidden="true"></i>
              }
              <span class="font-medium">{{ item.label }}</span>
            </div>

            @if (item.badge) {
              <p-badge
                [value]="item.badge"
                severity="warn"
                size="small">
              </p-badge>
            }
          </a>
        }

        <hr class="my-4 border-slate-200">

        <!-- Quick Actions for authenticated users -->
        @if (isAuthenticated()) {
          <div class="space-y-3">
            <button
              (click)="navigateToProfile(); closeMobileMenu()"
              class="w-full flex items-center px-4 py-3 text-base font-medium text-slate-700 hover:text-blue-600 hover:bg-slate-50 rounded-lg transition-colors duration-200">
              <i class="pi pi-user mr-3.5 text-lg text-slate-500" aria-hidden="true"></i>
              Account Settings
            </button>

            <button
              (click)="closeMobileMenu()"
              class="w-full flex items-center justify-between px-4 py-3 text-base font-medium text-slate-700 hover:text-blue-600 hover:bg-slate-50 rounded-lg transition-colors duration-200">
              <div class="flex items-center">
                <i class="pi pi-bell mr-3.5 text-lg text-slate-500" aria-hidden="true"></i>
                Notifications
              </div>
              @if (notificationCount() > 0) {
                <p-badge
                  [value]="notificationCount().toString()"
                  severity="danger"
                  styleClass="absolute -top-1 -right-1 !text-xs !min-w-4 !h-4 !leading-none !px-1">
                </p-badge>
              }
            </button>

            <button
              (click)="onLogout(); closeMobileMenu()"
              class="w-full flex items-center px-4 py-3 text-base font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors duration-200">
              <i class="pi pi-sign-out mr-3.5 text-lg" aria-hidden="true"></i>
              Sign Out
            </button>
          </div>
        } @else {
          <!-- Sign In for guests -->
          <p-button
            (onClick)="onSignIn(); closeMobileMenu()"
            label="Sign In to Your Account"
            icon="pi pi-sign-in"
            severity="primary"
            styleClass="!w-full !px-4 !py-3.5 shadow-sm hover:shadow-md transition-all duration-200">
            <ng-template pTemplate="content">
              <div class="flex items-center gap-2">
                <span class="text-base font-medium">Sign In to Your Account</span>
              </div>
            </ng-template>
          </p-button>
        }
      </nav>
    </div>
  }
</header>
