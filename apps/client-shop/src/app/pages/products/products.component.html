<!-- Professional B2B Product Catalog with Integrated Sidebar -->
<div class="products-catalog min-h-screen bg-slate-50">

  <!-- Mobile Header Component -->
  <app-mobile-header
    [productCount]="filteredShoes().length"
    [showFilters]="showMobileFilters()"
    [hasActiveFilters]="hasActiveFilters()"
    (toggleFilters)="toggleMobileFilters()">
  </app-mobile-header>

  <!-- Mobile Controls Component -->
  @if (isAuthenticated()) {
    <app-mobile-controls
      class="lg:hidden"
      [viewOptions]="viewOptions"
      [currentView]="currentView()"
      [sizeSystemOptions]="sizeSystemOptions"
      [sizeSystem]="sizeSystem()"
      [sortOptions]="sortOptions"
      [selectedSort]="selectedSort()"
      [itemsPerPageOptions]="itemsPerPageOptions"
      [itemsPerPage]="itemsPerPage()"
      (viewChange)="onViewChange($event)"
      (sizeSystemChange)="onSizeSystemChange($event)"
      (sortChange)="onSortChange($event)"
      (itemsPerPageChange)="itemsPerPage.set($event)">
    </app-mobile-controls>
  }

  <!-- Mobile Active Filters Bar Component -->
  <app-active-filters-bar
    class="lg:hidden"
    [hasActiveFilters]="hasActiveFilters()"
    [activeFilters]="activeFilters()"
    [productCount]="filteredShoes().length"
    [filterLoading]="filterLoading()"
    (clearAllFilters)="clearFilters()"
    (removeFilter)="onRemoveFilter($event)">
  </app-active-filters-bar>

  <!-- Main Layout Container -->
  <div class="flex min-h-screen">

    <!-- Desktop Sidebar / Mobile Filters Overlay -->
    <aside class="lg:w-80 lg:flex-shrink-0 lg:sticky lg:h-screen lg:overflow-y-auto">
      <!-- Desktop Sidebar Component -->
      <app-filter-sidebar
        class="hidden lg:block"
        [totalProducts]="allShoes().length"
        [filteredProducts]="filteredShoes().length"
        [searchTerm]="searchTerm()"
        [brandOptions]="brandOptions()"
        [selectedBrands]="selectedBrands()"
        [activeFilters]="activeFilters()"
        [hasActiveFilters]="hasActiveFilters()"
        (searchChange)="onSearchInput($event)"
        (clearSearch)="onClearSearch()"
        (toggleBrand)="toggleBrandFilter($event)"
        (clearAllFilters)="clearFilters()"
        (removeFilter)="onRemoveFilter($event)">
      </app-filter-sidebar>

      <!-- Mobile Filters Overlay Component -->
      <app-mobile-filters-overlay
        [showFilters]="showMobileFilters()"
        [searchTerm]="searchTerm()"
        [brandOptions]="brandOptions()"
        [selectedBrands]="selectedBrands()"
        (toggleFilters)="toggleMobileFilters()"
        (searchChange)="onSearchInput($event)"
        (clearSearch)="onClearSearch()"
        (toggleBrand)="toggleBrandFilter($event)"
        (clearAllFilters)="clearFilters()">
      </app-mobile-filters-overlay>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 lg:pl-6">
      <!-- Main Content Header (Desktop Only) -->
      <div class="hidden lg:block bg-white border border-slate-200 rounded-lg mb-6">
        <div class="px-6 py-4 border-b border-slate-200">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-bold text-slate-900">Product Catalog</h1>
              <p class="text-sm text-slate-600 mt-1">
                Browse our extensive wholesale footwear collection
              </p>
            </div>
          </div>
        </div>

        <!-- Desktop Controls (View/Sort/Size) -->
        <div class="px-6 py-4 border-b border-slate-200 bg-slate-50/50">
          <div class="flex items-center justify-between gap-6">
            <div class="flex items-center gap-6">
              <!-- View Toggle -->
              <div class="flex items-center gap-2">
                <span class="text-sm font-medium text-slate-700">View:</span>
                <p-selectButton
                  [options]="viewOptions"
                  optionLabel="label"
                  optionValue="value"
                  [ngModel]="currentView()"
                  (ngModelChange)="onViewChange($event)"
                  [allowEmpty]="false"
                  styleClass="!text-sm">
                </p-selectButton>
              </div>

              <!-- Size System - Only for authenticated users -->
              @if (isAuthenticated()) {
                <div class="flex items-center gap-2">
                  <span class="text-sm font-medium text-slate-700">Size:</span>
                  <p-selectButton
                    [options]="sizeSystemOptions"
                    optionLabel="label"
                    optionValue="value"
                    [ngModel]="sizeSystem()"
                    (ngModelChange)="onSizeSystemChange($event)"
                    [allowEmpty]="false"
                    styleClass="!text-sm">
                  </p-selectButton>
                </div>
              }
            </div>

            <!-- Sort and Show Controls - Only for authenticated users -->
            @if (isAuthenticated()) {
              <div class="flex flex-row gap-2">
                <!-- Sort -->
                <div class="flex items-center gap-2">
                  <span class="text-sm font-medium text-slate-700">Sort:</span>
                  <p-select
                    [options]="sortOptions"
                    optionLabel="label"
                    optionValue="value"
                    [ngModel]="selectedSort()"
                    (ngModelChange)="onSortChange($event)"
                    placeholder="Sort by"
                    styleClass="!w-40 !text-sm">
                  </p-select>
                </div>

                <!-- Items Per Page -->
                <div class="flex items-center gap-2">
                  <span class="text-sm font-medium text-slate-700">Show:</span>
                  <p-select
                    [options]="itemsPerPageOptions"
                    optionLabel="label"
                    optionValue="value"
                    [ngModel]="itemsPerPage()"
                    (ngModelChange)="itemsPerPage.set($event)"
                    styleClass="!w-40 !text-sm">
                  </p-select>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Loading State -->
      @if (loading()) {
        <div class="flex items-center justify-center py-20">
          <div class="text-center">
            <p-progressSpinner
              [style]="{ width: '50px', height: '50px' }"
              strokeWidth="4"
              fill="transparent"
              animationDuration=".8s">
            </p-progressSpinner>
            <p class="mt-4 text-slate-600 font-medium">Loading product catalog...</p>
          </div>
        </div>
      }

      <!-- Error State -->
      @if (error() && !loading()) {
        <div class="flex items-center justify-center py-20">
          <div class="text-center max-w-md mx-auto">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
              <i class="pi pi-exclamation-triangle text-red-600 text-2xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-slate-900 mb-3">Unable to Load Products</h3>
            <p class="text-slate-600 mb-6">{{ error() }}</p>
            <p-button
              label="Try Again"
              icon="pi pi-refresh"
              severity="primary"
              (onClick)="retryLoad()">
            </p-button>
          </div>
        </div>
      }

      <!-- Products Grid -->
      @if (!loading() && !error()) {
        <!-- Desktop Active Filters Bar Component -->
        <app-active-filters-bar
          class="hidden lg:block"
          [hasActiveFilters]="hasActiveFilters()"
          [activeFilters]="activeFilters()"
          [productCount]="filteredShoes().length"
          [filterLoading]="filterLoading()"
          (clearAllFilters)="clearFilters()"
          (removeFilter)="onRemoveFilter($event)">
        </app-active-filters-bar>

        <div class="lg:bg-white lg:border lg:border-slate-200 lg:rounded-lg overflow-hidden mt-0 lg:mt-0">
          <!-- Results Header - Hidden on mobile since info is in mobile header -->
          <div class="hidden lg:block px-6 py-4 border-b border-slate-200 bg-slate-50">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-lg font-semibold text-slate-900">
                  {{ filteredShoes().length }} Products Found
                </h2>
              </div>
            </div>
          </div>

          <!-- Product Grid Component -->
          <div class="md:p-3 lg:p-6">
            <app-product-grid
              [filteredProducts]="filteredShoes()"
              [viewMode]="currentView()"
              [mobileViewMode]="currentView() === 'grid' ? 'compact' : 'large'"
              [imageSize]="'medium'"
              [mobileImageSize]="'small'"
              [isLoading]="loading()"
              [sizeTemplates]="sizeTemplates()"
              [isMobile]="isMobile()"
              (addToCart)="onQuickOrder($event)"
              (mobileOrder)="onMobileOrder($event)"
              (viewDetails)="onViewDetails($event)"
              (clearFilters)="clearFilters()">
            </app-product-grid>
          </div>
        </div>
      }
    </main>
  </div>

  <!-- Order Dialog -->
  <p-dialog
    [(visible)]="showMobileOrderDialog"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    [closeOnEscape]="true"
    styleClass="order-dialog w-full h-full max-w-none max-h-none m-0 bg-white lg:w-auto lg:h-auto lg:max-w-2xl lg:max-h-[80vh] lg:m-4"
    [showHeader]="false"
    position="center">

    @if (selectedProductForOrder()) {
      <div class="flex flex-col h-full lg:h-auto lg:min-h-96">
        <!-- Custom Header -->
        <div class="flex items-center justify-between p-4 border-b border-slate-200 bg-slate-50">
          <div class="flex items-center gap-3">
            <button
              type="button"
              class="flex items-center justify-center w-8 h-8 text-slate-600 hover:text-slate-900 hover:bg-slate-200 rounded-full transition-colors"
              (click)="onMobileOrderCancel()"
              [attr.aria-label]="'Close order dialog'">
              <i class="pi pi-arrow-left text-lg lg:hidden"></i>
              <i class="pi pi-times text-lg hidden lg:block"></i>
            </button>
            <div>
              <h2 class="text-lg font-semibold text-slate-900">Place Order</h2>
              <p class="text-sm text-slate-600">{{ selectedProductForOrder()?.name }}</p>
            </div>
          </div>
        </div>

        <!-- Order Form Container -->
        <div class="flex-1 overflow-y-auto p-4 lg:p-6">
          <app-quick-order
            [product]="selectedProductForOrder()!"
            [isSubmitting]="orderDialogSubmitting()"
            (placeOrder)="onMobileOrderSubmit($event)"
            (cancelOrder)="onMobileOrderCancel()">
          </app-quick-order>
        </div>
      </div>
    }
  </p-dialog>
</div>
